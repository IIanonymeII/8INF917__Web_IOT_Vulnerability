from django.shortcuts import render
import requests
from django.http import JsonResponse
from django.conf import settings
from database.models import CVE
from database.views import update_database_from_nvd


def get_nvd_vulnerabilities():
    url = "https://services.nvd.nist.gov/rest/json/cves/2.0"
    # params = {'api_key': settings.NVD_API_KEY}  # Assuming you have NVD_API_KEY defined in your settings
    # print(params)
    response = requests.get(url)
    if response.status_code == 200:
        return response.json()
    else:
        return None
    

def update_bd(request):
    return update_database_from_nvd()


def home_page(request):
    vulnerabilities = CVE.objects.all().order_by('-lastModified')[:10]
    return render(request, 'home.html', {'vulnerabilities': vulnerabilities})