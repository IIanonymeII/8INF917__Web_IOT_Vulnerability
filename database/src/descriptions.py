

from database.models import Description

def create_or_update_descriptions(cve, descriptions_data):
    try:
        for description_data in descriptions_data:
            lang = description_data['lang']
            existing_description = get_existing_descriptions(cve, lang)
            if existing_description:
                update_existing_description(existing_description, description_data)
            else:
                create_new_description(cve, description_data)

    except Exception as e:
        raise Exception(f"Failed to create or update Description: {e}")


def get_existing_descriptions(cve, lang):
    try:
        return Description.objects.filter(cve=cve, lang=lang).first()
    except Exception as e:
        raise Exception(f"Failed to get existing Description: {e}")


def update_existing_description(existing_description, description_data):
    try:
        value = description_data['value']
        if existing_description.value != value:
            existing_description.value = value
            existing_description.save()
            print("    UPDATE -> description")
       
    except Exception as exc:
        raise Exception(f"Failed to update existing Description: {exc}")


def create_new_description(cve, description_data):
    try:
        Description.objects.create(
            cve=cve,
            lang=description_data['lang'],
            value=description_data['value']
        )
        print("    CREATE -> description")
    except Exception as exc:
        raise Exception(f"Failed to create new Description: {exc}")
