{% extends "base.html" %}
{% load json_filters %}
{% load urlize %}
{% load static %}


{% block title %}
	Détails de la {{ cve.id }}
{% endblock %}

{% block links %}
	<link rel="stylesheet" href="{% static 'style/details.css' %}">
	<link rel="stylesheet" href="{% static 'style/treeview.vanilla.css' %}"/>
{% endblock %}

{% block content %}
	<h2>{{ cve.title }}</h2>

	<section class="infos severity border {{ cve.severity }}">
		<div>
			<h3>Informations générales</h3>
		</div>

		<div>
			<ul>
				<li>Publication : {{ cve.release_date }}</li>
				<li>Dernière mise à jour : {{ cve.release_date }}</li>
				<li>Type : {{ cve.type }}</li>
				<li>Gravité : {{ cve.severity }}</li>
			</ul>
		</div>
	</section>

	<section class="severity border {{ cve.severity }}">
		<div>
			<h3>Description</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			<pre>{{ cve.description }}</pre>
			{#			<p>{{ cve.description }}</p>#}
		</div>
	</section>

	<section class="severity border {{ cve.severity }}">
		<div>
			<h3>Appareils concernés ({{ cve.affected_products.all | length }})</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			{% if cve.affected_products.all|length > 0 %}
				<input type="search" id="details-search" placeholder="Rechercher un appareil">
				<div id="tree"></div>
			{% else %}
				<p>Aucun appareil concerné</p>
			{% endif %}
		</div>
	</section>

	<section id="patches" class="severity border {{ cve.severity }}">
		<div>
			<h3>Correctifs ({{ cve.patches.all | length }})</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			{% if cve.patches.all|length > 0 %}
				<ul>
					{% for patch in cve.patches.all %}
						<li>
							<p><b>{{ patch.name }}</b></p>
							<a href="{{ patch.url }}" target="_blank">{{ patch.url }}</a>
						</li>
					{% endfor %}
				</ul>
			{% else %}
				<p>Aucun correctif connu</p>
			{% endif %}
		</div>
	</section>

	<section class="severity border {{ cve.severity }}">
		<div>
			<h3>Bases de données ({{ cve.data_sources.all | length }})</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			{% if cve.data_sources.all|length > 0 %}
				<ul>
					{% for link in cve.data_sources.all %}
						<li>
							<p style="{% if link.is_recognized %}color:  #61bd6d;{%  endif %}{% if link.is_unlinked %}color:  #e14938;{%  endif %}"><b>{{ link.name }}</b></p>
							<a href="{{ link.get_url }}" target="_blank">{{ link.external_id }}</a>
						</li>
					{% endfor %}
				</ul>
			{% else %}
				<p>Aucun lien connu</p>
			{% endif %}
		</div>
	</section>

	<section id="exploits" class="severity border {{ cve.severity }}">
		<div>
			<h3>Exploits ({{ exploits_qtt }})</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			{% if exploits_qtt > 0 %}
				<table>
				    <thead>
				        <tr>
				            <th>Publication</th>
				            <th>Type</th>
				            <th>Platforme / Vendeur</th>
				            <th>Auteur</th>
				            <th></th>
				            <th></th>
				        </tr>
				    </thead>
				    <tbody>
				        {% for exploit in exploit_db_exploits.data %}
					        <tr>
					            <td>{{ exploit.date_published }}</td>
					            <td>{{ exploit.type.name }}</td>
					            <td>{{ exploit.platform.platform }}</td>
					            <td>{{ exploit.author.name }}</td>
					            <td><a href="https://www.exploit-db.com/exploits/{{ exploit.id }}" target="_blank"><img src="{% static 'images/eye.png' %}" alt="view page"></a></td>
					            <td><a href="https://www.exploit-db.com/download/{{ exploit.id }}"><img src="{% static 'images/download.png' %}" alt="download"></a></td>
					        </tr>
				        {% endfor %}
{#				    {'id': 'VAR-E-201704-0410', 'exploit': {'_id': None, 'data': 'Attackers must trick a user into opening a file on a remote WebDAV or SMB share to exploit this issue.\nA general exploit technique has been documented by TheLeader and H.D. Moore for the Metasploit Project; please see the references for more information.', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'price': {'_id': None, 'data': 'Free', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'affected_products': {'_id': None, 'data': [{'_id': None, 'model': 'sdxc memory card with embedded nfc functionality software update', 'vendor': 'toshiba', 'scope': 'eq', 'version': '1.0.3', 'trust': 0.3}, {'_id': None, 'model': 'sdxc memory card with embedded nfc functionality software update', 'vendor': 'toshiba', 'scope': 'eq', 'version': '0', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card flashairtm software update tool', 'vendor': 'toshiba', 'scope': 'eq', 'version': '3.0.1', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card flashairtm software update tool', 'vendor': 'toshiba', 'scope': 'eq', 'version': '0', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card flashairtm configuration software', 'vendor': 'toshiba', 'scope': 'eq', 'version': '3.0.2', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card flashairtm configuration software', 'vendor': 'toshiba', 'scope': 'eq', 'version': '0', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card', 'vendor': 'toshiba', 'scope': 'eq', 'version': '1.0.3', 'trust': 0.3}, {'_id': None, 'model': 'sdhc memory card', 'vendor': 'toshiba', 'scope': 'eq', 'version': '0', 'trust': 0.3}], 'sources': [{'db': 'BID', 'id': '97697'}]}, 'credits': {'_id': None, 'data': 'Yuji Tounai of NTT Communications Corporation.', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'cve': {'_id': None, 'data': [{'cve_id': 'CVE-2017-2149', 'trust': 0.3}], 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': None}, 'description': {'_id': None, 'data': 'Multiple Toshiba memory card installers are prone to a remote code-execution vulnerability.\nA remote attacker can leverage this issue to execute arbitrary code in the context of the affected application.\nThe following products are vulnerable:\nSDHC/SDXC Memory Card with embedded NFC functionality Software Update Tool 1.00.03 and prior versions.\nSDHC Memory Card with embedded wireless LAN functionality FlashAirTM Configuration Software 3.0.2 and prior versions.\nSDHC Memory Card with embedded wireless LAN functionality FlashAirTM Software Update tool (SD-WE series) 3.00.01\nSDHC Memory Card with embedded wireless LAN functionality FlashAirTM Software Update tool (SD-WD/WC series) 2.00.03 and prior versions.\nSDHC Memory Card with embedded wireless LAN functionality FlashAirTM  Software Update tool (SD-WB/WL series) 1.00.04 and prior versions.\nSDHC Memory Card with embedded TransferJetTM functionality Configuration Software 1.02 and prior versions.\nSDHC Memory Card with embedded TransferJetTM functionality Software Update tool 1.00.06 and prior versions.', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'external_ids': {'_id': None, 'data': [{'db': 'JVN', 'id': 'JVN05340816', 'trust': 0.3}, {'db': 'NVD', 'id': 'CVE-2017-2149', 'trust': 0.3}, {'db': 'BID', 'id': '97697', 'trust': 0.3}], 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': None}, 'iot': {'_id': None, 'data': True, 'sources': [{'db': 'VARIoT devices database', 'id': None}], 'trust': 0.875}, 'sources': {'_id': None, 'data': [{'db': 'BID', 'id': '97697', 'url': 'https://www.securityfocus.com/bid/97697'}], 'sources': None, 'trust': None}, 'references': {'_id': None, 'data': [{'url': 'http://blog.metasploit.com/2010/08/exploiting-dll-hijacking-flaws.html', 'trust': 0.3}, {'url': 'http://jvn.jp/en/jp/jvn05340816/index.html', 'trust': 0.3}, {'url': 'http://blogs.technet.com/b/srd/archive/2010/08/23/more-information-about-dll-preloading-remote-attack-vector.aspx', 'trust': 0.3}], 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': None}, 'sources_update_date': {'_id': None, 'data': [{'db': 'BID', 'id': '97697', 'ident': None, 'date': '2017-04-18T00:07:00'}]}, 'sources_release_date': {'_id': None, 'data': [{'db': 'BID', 'id': '97697', 'ident': None, 'date': '2017-04-14T00:00:00'}]}, 'title': {'_id': None, 'data': 'Multiple Toshiba memory card installers DLL Loading Remote Code Execution Vulnerability', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'type': {'_id': None, 'data': 'Design Error', 'sources': [{'db': 'BID', 'id': '97697'}], 'trust': 0.3}, 'last_update_date': '2022-07-27T09:56:17.763000Z'}#}
				        <tr>
				            <td>{{ variot_exploits.sources_release_date.data.0.date }}</td>
				            <td>{{ variot_exploits.type.data }}</td>
				            <td>{{ variot_exploits.affected_products.data.0.vendor }} {{ variot_exploits.affected_products.data.0.model }}</td>
				            <td>{{ variot_exploits.credits.data }}</td>
				        </tr>
				    </tbody>
				</table>
			{% else %}
				<p>Aucun exploit connu</p>
			{% endif %}
		</div>
	</section>
{% endblock %}

{% block scripts %}
	<script>
        const desc = {{ cve.description | json_encode | safe }};
        const devices = {{ cve.affected_products.all | json_encode | safe }};
	</script>
	<script src="{% static 'scripts/treeview.vanilla.js' %}"></script>
	<script src="{% static 'scripts/details.js' %}"></script>
{% endblock %}