{% extends "base.html" %}
{% load json_filters %}
{% load urlize %}
{% load static %}


{% block title %}
	Détails de la {{ cve.id }}
{% endblock %}

{% block links %}
	<link rel="stylesheet" href="{% static 'style/details.css' %}">
	<link rel="stylesheet" href="{% static 'style/treeview.vanilla.css' %}"/>
{% endblock %}

{% block content %}
	<h2>{{ cve.title }}</h2>

	{#	{{ cve | json_encode | safe }}#}

	<section class="infos severity border {{ cve.severity }}">
		<div>
			<h3>Informations générales</h3>
		</div>

		<div>
			<ul>
				<li>Publication : {{ cve.release_date }}</li>
				<li>Dernière mise à jour : {{ cve.last_updated }}</li>
				<li>Type : {{ cve.type }}</li>
				<li>Gravité : {{ cve.severity }}</li>
			</ul>
		</div>
	</section>

	<section class="severity border {{ cve.severity }}">
		<div>
			<h3>Description</h3>
			<p>▼</p>
		</div>

		<div style="display: none">
			<pre>{{ cve.description }}</pre>
			{#			<p>{{ cve.description }}</p>#}
		</div>
	</section>

	{% if cve.affected_products.all|length > 0 %}
		<section class="severity border {{ cve.severity }}">
			<div>
				<h3>Appareils concernés ({{ cve.affected_products.all | length }})</h3>
				<p>▼</p>
			</div>

			<div style="display: none">
				<input type="search" id="details-search" placeholder="Rechercher un appareil">
				<div id="tree"></div>
			</div>
		</section>
	{% endif %}

	{% if cve.patches.all|length > 0 %}
		<section id="patches" class="severity border {{ cve.severity }}">
			<div>
				<h3>Correctifs ({{ cve.patches.all | length }})</h3>
				<p>▼</p>
			</div>

			<div style="display: none">
				<ul>
					{% for patch in cve.patches.all %}
						<li>
							<p><b>{{ patch.name }}</b></p>
							<a href="{{ patch.url }}" target="_blank">{{ patch.url }}</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</section>
	{% endif %}

	{% if cve.data_sources.all|length > 0 %}
		<section class="severity border {{ cve.severity }}">
			<div>
				<h3>Liens ({{ cve.data_sources.all | length }})</h3>
				<p>▼</p>
			</div>

			<div style="display: none">
				<ul>
					{% for link in cve.data_sources.all %}
						<li>
							<p style="{% if link.is_recognized %}color:  #61bd6d;{%  endif %}{% if link.is_unlinked %}color:  #e14938;{%  endif %}"><b>{{ link.name }}</b></p>
							<a href="{{ link.get_url }}" target="_blank">{{ link.external_id }}</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</section>
	{% endif %}
{% endblock %}

{% block scripts %}
	<script>
        const desc = {{ cve.description | json_encode | safe }};
        const devices = {{ cve.affected_products.all | json_encode | safe }};
	</script>
	<script src="{% static 'scripts/treeview.vanilla.js' %}"></script>
	<script src="{% static 'scripts/details.js' %}"></script>
{% endblock %}