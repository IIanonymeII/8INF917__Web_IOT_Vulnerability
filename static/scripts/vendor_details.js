const grid = new gridjs.Grid({
	columns: [
		{
			name: 'id',
			hidden: true,
		},
		{
			name: 'Mise √† jour',
			width: '15%'
		},
		{
			name: 'Titre',
			attributes: (cell) => {
				if (cell)
					return {
						'pointer': ''
					}
			}
		},
		{
			name: 'S√©v√©rit√©',
			width: '10%',
			attributes: (cell, row, column) => {
				if (cell) {
					return {
						class: `severity back ${cell}`,
						style: 'text-align: center; border: 1px solid white;'
					};
				}
			}
		},
		{
			name: 'Appareils affect√©s',
			width: '15%'
		}
	],
	server: {
		// replace <vendor_id> with the actual vendor id from url
		url: "/api/vendor/" + window.location.pathname.split("/")[2] + "?",
		then: data => {
			console.log(data);
			return data.data.map((item) => {
				const date = new Date(item.last_updated);
				return [item.id, date.toLocaleString(), item.type, item.severity, item.devices_affected]
			});
		},
		total: data => data.total,
	},
	search: {
		server: {
			url: (prev, keyword) => `${prev}&search=${keyword}`
		}
	},
	pagination: {
		limit: 10,
		summary: true,
		server: {
			url: (prev, page, limit) => `${prev}&page=${page}`
		}
	},
	sort: {
		server: {
			url: (prev, columns) => {
				if (!columns.length)
					return prev;

				const col = columns[0];
				const dir = col.direction === 1 ? 'asc' : 'desc';
				let colName = ['id', 'last_updated', 'type', 'severity', 'affected_products_count'][col.index];

				return `${prev}&order=${colName}&dir=${dir}`;
			}
		}
	},
	resizable: true,
	fixedHeader: true,
	language: {
		search: {
			placeholder: 'üîç Recherche...',
		},
		sort: {
			sortAsc: "Trier la colonne dans l'ordre croissant",
			sortDesc: "Trier la colonne dans l'ordre d√©croissant",
		},
		pagination: {
			previous: 'Pr√©c√©dent',
			next: 'Suivant',
			navigate: (page, pages) => `Page ${page} de ${pages}`,
			page: (page) => `Page ${page}`,
			showing: 'Affichage des r√©sultats',
			of: 'sur',
			to: '√†',
			results: '',
		},
		loading: 'Chargement...',
		noRecordsFound: 'Aucun r√©sultat trouv√©',
		error: 'Une erreur est survenue lors de la r√©cup√©ration des donn√©es',
	}
}).render(document.querySelector('table'));

grid.on('cellClick', (...args) => {
	const id = args[3].cells[0].data;
	const cellId = args[2].id;
	if (cellId === "titre")
		window.location.href = `/details/${id}`;
});